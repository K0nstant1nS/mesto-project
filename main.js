(()=>{"use strict";function e(e,t){t?(e.classList.remove(e.dataset.disabled),e.disabled=!1):(e.classList.add(e.dataset.disabled),e.disabled=!0)}function t(e){return e.validity.patternMismatch?{state:!1,message:e.dataset.mismatch}:e.validity.valid?{state:!0}:{state:!1,message:e.validationMessage}}function n(e){let n=document.querySelector(`#${e.name}-error`);const o=t(e);o.state?n.classList.remove(n.dataset.onerror):(n.classList.add(n.dataset.onerror),n.textContent=o.message)}function o(o){const r=document.forms[o.formName],a=r.querySelector(o.submitButtonSelector),c=Array.from(r.querySelectorAll(o.inputSelector));Array.from(c).every((function(e){return""===e.value}))||c.forEach((function(e){n(e)})),e(a,function(e,n){return Array.from(e.querySelectorAll(n)).every((function(e){return t(e).state}))}(r,o.inputSelector))}function r(o){const r=document.forms[o.formName],a=r.querySelector(o.submitButtonSelector),c=Array.from(r.querySelectorAll(o.inputSelector));c.forEach((function(o){o.addEventListener("input",(function(r){n(o);let u=c.every((function(e){return t(e).state}));e(a,u)}))}))}function a(e){e.classList.add("popup_opened"),document.addEventListener("keydown",i)}function c(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",i)}function u(e){const t=document.querySelector(".popup_opened");e.target!==t.querySelector(".popup__close")&&e.target!==t&&"Escape"!==e.key||c(t)}function i(e){u(e)}const l=document.querySelector("#profile__add"),d=l.querySelector(".popup__save"),s=document.querySelector("#remove__card"),m=s.querySelector(".popup__profile-form"),p=s.querySelector(".popup__save"),f=document.querySelector("#profile__avatar"),h=f.querySelector(".popup__save"),_=document.querySelector(".places-cards"),y=document.querySelector("#profile__edit"),v=y.querySelector(".popup__save"),S=document.querySelector(".profile__edit-button"),b=document.querySelector(".profile__add-button"),q=document.querySelector(".profile__image"),k=document.querySelector(".profile__image-container"),g=document.querySelector(".profile__name"),E=document.querySelector(".profile__about"),L=document.querySelector("[name='guest-name']"),O=document.querySelector("[name='guest-about']"),j=document.querySelector("[name='place-name']"),x=document.querySelector("[name='place-link']"),C=document.querySelector("[name='avatar-link']"),$=document.querySelector("[name='card-form']"),z=document.querySelector("[name='avatar-form']"),T=document.querySelector("#card-template").content.querySelector(".card"),A=document.querySelector("#image-popup"),U=A.querySelector(".popup__image-title"),N=A.querySelector(".popup__image"),w={formName:"guest-form",submitButtonSelector:".popup__save",inputSelector:".popup__text-input"},B={formName:"card-form",submitButtonSelector:".popup__save",inputSelector:".popup__text-input"},D={formName:"avatar-form",submitButtonSelector:".popup__save",inputSelector:".popup__text-input"};function P(e){e.classList.toggle("card__like_active")}function F(e,t){return e.likes.filter((function(e){return e._id===t._id})).length>0}const J={baseUrl:"https://nomoreparties.co/v1/plus-cohort-16",headers:{authorization:"dec5d51c-e797-4698-837e-5a0bd4b0f1d8","Content-Type":"application/json"}};function G(e){return e.ok?e.json():Promise.reject(`Ошибка. Статус - ${e.status}`)}function H(e){g.textContent=e.name,E.textContent=e.about}function I(e){q.src=e}function M(e){var t;(t=e.cardObj,fetch(`${J.baseUrl}/cards/likes/${t._id}`,{method:"PUT",headers:{authorization:J.headers.authorization}}).then(G)).then((t=>{e.counterElement.textContent=t.likes.length,e.changeStateFunc(e.likeElement),e.cardObj.likes.push(e.idObj)})).catch((e=>{console.log(e)}))}function K(e){var t;(t=e.cardObj,fetch(`${J.baseUrl}/cards/likes/${t._id}`,{method:"DELETE",headers:{authorization:J.headers.authorization}}).then(G)).then((t=>{e.counterElement.textContent=t.likes.length,e.changeStateFunc(e.likeElement),e.cardObj.likes=e.cardObj.likes.filter((function(t){return t._id!==e.idObj._id}))})).catch((e=>{console.log(e)}))}function Q(e,t,n){!function(e,t){return t._id===e.owner._id}(e,n)?t.remove():t.addEventListener("click",(function(){a(s),m.onsubmit=function(n){var o,r;n.preventDefault(),p.textContent=p.dataset.onload,o=e,r=t.parentElement,function(e){return fetch(`${J.baseUrl}/cards/${e._id}`,{method:"DELETE",headers:{authorization:J.headers.authorization}}).then(G)}(o).then((()=>{r.remove(),c(s)})).catch((e=>{console.log(e)})).finally((()=>{p.textContent=p.dataset.default}))}}))}function R(e,t){_.prepend(function(e){const t=e.Obj,n=T.cloneNode(!0),o=n.querySelector(".card__like"),r=n.querySelector(".card__trash"),c=n.querySelector(".card__image"),u=n.querySelector(".card__likes-counter");var i;return u.textContent=t.likes.length,c.alt="Фотография "+t.name,c.src=t.link,n.querySelector(".card__caption").textContent=t.name,i=o,F(t,e.idObj)?i.classList.add("card__like_active"):i.classList.remove("card__like_active"),o.addEventListener("click",(()=>{F(t,e.idObj)?e.deleteLike({cardObj:t,likeElement:o,counterElement:u,idObj:e.idObj,changeStateFunc:P}):e.addLike({cardObj:t,likeElement:o,counterElement:u,idObj:e.idObj,changeStateFunc:P})})),e.prepareTrashButton(t,r,e.idObj),c.addEventListener("click",(function(){!function(e){U.textContent=e.name,N.src=e.link,N.alt="Фотография "+e.name,a(A)}(t)})),n}({Obj:e,idObj:t,prepareTrashButton:Q,addLike:M,deleteLike:K}))}r(w),r(B),r(D),document.querySelectorAll(".popup").forEach((function(e){e.classList.add("popup_type_animated")})),Promise.all([fetch(`${J.baseUrl}/users/me`,{method:"GET",headers:{authorization:J.headers.authorization}}).then(G),fetch(`${J.baseUrl}/cards`,{method:"GET",headers:{authorization:J.headers.authorization}}).then(G)]).then((e=>{e[1].forEach((function(t){const n=new Image;n.onload=function(){R(t,e[0])},n.src=t.link})),H(e[0]),I(e[0].avatar)})).catch((e=>{console.log(e)})),document.addEventListener("mousedown",(e=>{document.querySelector(".popup_opened")&&u(e)})),document.querySelector("[name='guest-form']").addEventListener("submit",(function(e){e.preventDefault(),v.textContent=v.dataset.onload,function(e,t){return fetch(`${J.baseUrl}/users/me`,{method:"PATCH",headers:J.headers,body:JSON.stringify({name:e.value,about:t.value})}).then(G)}(L,O).then((()=>{H({name:L.value,about:O.value}),c(y)})).catch((e=>{console.log(e)})).finally((()=>{v.textContent=v.dataset.default}))})),S.addEventListener("click",(function(){L.value=g.textContent,O.value=E.textContent})),S.addEventListener("click",(function(){a(y),o(w)})),b.addEventListener("click",(function(){a(l),o(B)})),k.addEventListener("click",(function(e){a(f),o(D)})),$.addEventListener("submit",(function(e){d.textContent=d.dataset.onload,e.preventDefault(),function(e,t){return fetch(`${J.baseUrl}/cards`,{method:"POST",headers:J.headers,body:JSON.stringify({name:e.value,link:t.value})}).then(G)}(j,x).then((e=>{const t=new Image;t.onload=function(){R(e,e.owner)},t.src=e.link,c(l),$.reset()})).catch((e=>{console.log(e)})).finally((()=>{d.textContent=d.dataset.default}))})),z.addEventListener("submit",(function(e){e.preventDefault(),h.textContent=h.dataset.onload,function(e){return fetch(`${J.baseUrl}/users/me/avatar`,{method:"PATCH",headers:J.headers,body:JSON.stringify({avatar:e.value})}).then(G)}(C).then((()=>{I(C.value),c(f),z.reset()})).catch((e=>{console.log(e)})).finally((()=>{h.textContent=h.dataset.default}))}))})();