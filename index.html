<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Mesto">
    <meta name="author" content="Соловьев Константин">
    <meta name="keywords" content="Mesto">
    <link rel="stylesheet" href="./pages/index.css">
    <title>Место</title>
</head>
<body class="page">
    <div class="page__content">
        <header class="header">
            <a href="#"><img class="header__logo" alt="Лого" src="./images/Mesto_logo.svg"></a>
        </header>
        <section class="profile">
            <div class="profile__person">
                <img alt="Жак-Ив Кусто" src="./images/kusto.jpg" class="profile__image">
                <div class="profile__person-desription">
                    <div class="profile__name-and-edit"><h1 class="profile__name">Жак-Ив Кусто</h1><button type="button" class="profile__edit-button"></button></div>
                    <p class="profile__about">Исследователь океана</p>
                </div>
            </div>
            <button type="button" class="profile__add-button"></button>
        </section>
        <section class="places-cards">
        <template id="card-template">
            <article class="card">
                <img src="" class="card__image">
                <div class="card__attributes-container">
                    <h2 class="card__caption"></h2><button type="button" class="card__like card__like_disabled"></button>
                </div>
                <button type="button" class="card__trash"></button>
                <div class ="popup">
                    <div>
                    <img src="" class="popup__image">
                    <button type="button" class="popup__close"></button>
                    </div>
                </div>
            </article>
        </template>
        </section>
        <footer class="footer">
            <p class="footer__author">© 2022. Соловьев Константин</p>
        </footer>
</div>
<div id="profile__edit" class="popup">
    <div class="popup__profile-popup">
        <h3 class="popup__caption">Редактировать профиль</h3>
        <form name="guest-form" class="popup__profile-form">
            <fieldset class="popup__person">
                <input name="guest-name" class="popup__text-input" type="text" value="Жак-Ив Кусто">
                <input name="guest-about" class="popup__text-input" value="Исследователь океана" type="text">
            </fieldset>
            <button type="submit" class="popup__save">Сохранить</button>
        </form>
        <button type="button" class="popup__close"></button>
    </div>
</div>
<div id="profile__add" class="popup">
    <div class="popup__profile-popup">
        <h3 class="popup__caption">Новое место</h3>
        <form name="card-form" class="popup__profile-form">
            <fieldset class="popup__person">
                <input name="place-name" class="popup__text-input" type="text" placeholder="Название">
                <input name="place-link" class="popup__text-input" placeholder="Ссылка на картинку" type="text">
            </fieldset>
            <button type="submit" class="popup__save">Создать</button>
        </form>
        <button type="button" class="popup__close"></button>
    </div>
</div>

<script>

  //Отмена поведения по умолчанию для submit
    const buttonSaveElementsList = document.querySelectorAll(".popup__save");

    function formSubmitHandler (evt) {
        evt.preventDefault(); 
    }

    buttonSaveElementsList.forEach(function(item){
        return item.addEventListener("click", formSubmitHandler)
    })

  // Код для закрытия/открытия форм
    const buttonsCloseList = document.querySelectorAll(".popup__close");
    const profileEditButton = document.querySelector(".profile__edit-button");
    const profileAddButton = document.querySelector(".profile__add-button");

    function addOpenPopupEvent(element){
        element.addEventListener("click",function(){
            const elemClassName = element.classList[0];
            const popupId = elemClassName.split("-")[0];
            document.querySelector("#" + popupId).classList.add("popup_opened")
        })
    }

    addOpenPopupEvent(profileEditButton);
    addOpenPopupEvent(profileAddButton);

    buttonsCloseList.forEach(function(item){
       return item.addEventListener("click", function(){
        item.parentElement.parentElement.classList.remove("popup_opened")
       })
    });

  // Код для внесения в value формы данных из profile__person
    const personNameElement = document.querySelector(".profile__name");
    const personAboutElement = document.querySelector(".profile__about");
    const personNameInput = document.querySelector("[name='guest-name']");
    const personAboutInput = document.querySelector("[name='guest-about']");
    const personEditPopup = document.querySelector("#profile__edit");
    const buttonSavePerson = document.querySelector("#profile__edit .popup__save");

    buttonSavePerson.addEventListener("click",function(){
        personNameElement.textContent = personNameInput.value;
        personAboutElement.textContent = personAboutInput.value;
        personEditPopup.classList.remove("popup_opened")
    })

    //Заполнение places-cards

    const cardElementTemplate = document.querySelector("#card-template").content;
    const cardsContainerElement = document.querySelector(".places-cards");


    const initialCards = [
{
  name: 'Архыз',
  link: 'https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg'
},
{
  name: 'Челябинская область',
  link: 'https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg'
},
{
  name: 'Иваново',
  link: 'https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg'
},
{
  name: 'Камчатка',
  link: 'https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg'
},
{
  name: 'Холмогорский район',
  link: 'https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg'
},
{
  name: 'Байкал',
  link: 'https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg'
}
];



    function makeNewCard(name,link){
        const newCardElement = cardElementTemplate.cloneNode(true);
        const likeButtonElement = newCardElement.querySelector(".card__like");
        const trashButtonElement = newCardElement.querySelector(".card__trash");
        const popupImageElement = newCardElement.querySelector(".popup__image");
        const popupCloseElement = newCardElement.querySelector('.popup__close');
        likeButtonElement.addEventListener("click",()=>{
            likeButtonElement.classList.toggle("card__like_disabled")
            likeButtonElement.classList.toggle("card__like_active")
        })
        trashButtonElement.addEventListener("click",()=> trashButtonElement.parentElement.remove())
        newCardElement.querySelector(".card__image").src = link; //initialCards[i].link;
        newCardElement.querySelector(".card__caption").textContent = name; //initialCards[i].name;
        popupImageElement.src = link;
        popupImageElement.parentElement.style.position = "relative";
        popupCloseElement.addEventListener("click",function(){
            popupCloseElement.parentElement.parentElement.classList.remove("popup_opened");
        })
        newCardElement.querySelector(".card__image").addEventListener("click",function(){
            popupImageElement.parentElement.parentElement.classList.add("popup_opened")
        })
        cardsContainerElement.append(newCardElement);
        }

    for(let i = 0; i < initialCards.length; i++){
        makeNewCard(initialCards[i].name,initialCards[i].link)
    }


  //Добавление карточек через popup
    const personAddPopup = document.querySelector("#profile__add");
    const cardAddButtonElement = personAddPopup.querySelector(".popup__save");


    cardAddButtonElement.addEventListener("click",function(){
        const inputPlaceNameElement = document.querySelector("[name='place-name']");
        const inputPlaceLinkElement = document.querySelector("[name='place-link']");
        makeNewCard(inputPlaceNameElement.value ,inputPlaceLinkElement.value)
        personAddPopup.classList.remove("popup_opened");
        inputPlaceNameElement.value = '';
        inputPlaceLinkElement.value = '';
    })


    
</script>
</body>
</html>